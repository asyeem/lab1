#!/bin/bash

# System Information
HOSTNAME=$(hostname)
OS=$(source /etc/os-release && echo "$PRETTY_NAME")
UPTIME=$(uptime -p)

# Hardware Information
CPU=$(lshw -class processor | awk '/product/ {print $2}')
CPU_SPEED=$(lscpu | awk '/^CPU MHz/ {printf "%.2f GHz", $3/1000}')
RAM=$(free -h | awk '/^Mem:/ {print $2}')
DISKS=$(lsblk -o NAME,MODEL,SIZE -d | sed 's/^\s*//')
VIDEO=$(lshw -class display | awk '/product/ {print $2}')

# Network Information
FQDN=$(hostname -f)
HOST_IP=$(ip a show dev $(ip r | awk '/default/ {print $5}') | awk '/inet / {print $2}')
GATEWAY=$(ip r | awk '/default/ {print $3}')
DNS_SERVER=$(grep -E "nameserver" /etc/resolv.conf | awk '{print $2}')
INTERFACE=$(ip r | awk '/default/ {print $5}')
IP_ADDRESS=$(ip a show dev $INTERFACE | awk '/inet / {print $2}')

# System Status
USERS=$(who | cut -d' ' -f1 | sort -u)
DISK_SPACE=$(df -h | awk '/^\/dev/ {print $1, $4}')
PROCESS_COUNT=$(ps -e --no-header | wc -l)
LOAD_AVERAGES=$(cat /proc/loadavg | awk '{print $1 ", " $2 ", " $3}')
MEMORY=$(free -h | awk '/^Mem:/ {print $3 "/" $2}')

# Listening Network Ports
NETWORK_PORTS=$(ss -tunl | awk '/^tcp/ {print $5}')

# UFW Rules
UFW_RULES=$(sudo ufw show raw | grep -oP '^\d+\s+ALLOW\s+\S+\s+Anywhere$')

# Generate the report
echo "System Report generated by $USER, $(date +"%F %T")"
echo

echo "System Information"
echo "-------------------"
echo "Hostname: $HOSTNAME"
echo "OS: $OS"
echo "Uptime: $UPTIME"
echo

echo "Hardware Information"
echo "----------------------"
echo "CPU: $CPU"
echo "Speed: $CPU_SPEED"
echo "RAM: $RAM"
echo "Disk(s):"
echo "$DISKS"
echo "Video: $VIDEO"
echo

echo "Network Information"
echo "---------------------"
echo "FQDN: $FQDN"
echo "Host Address: $HOST_IP"
echo "Gateway IP: $GATEWAY"
echo "DNS Server: $DNS_SERVER"
echo "Interface Name: $INTERFACE"
echo "IP Address: $IP_ADDRESS"
echo

echo "System Status"
echo "--------------"
echo "Users Logged In: $USERS"
echo "Disk Space:"
echo "$DISK_SPACE"
echo "Process Count: $PROCESS_COUNT"
echo "Load Averages: $LOAD_AVERAGES"
echo "Memory Allocation: $MEMORY"
echo "Listening Network Ports: $NETWORK_PORTS"
echo "UFW Rules:"
echo "$UFW_RULES"

OUTPUT
System Information
-------------------
Hostname: pc200507129
OS: Ubuntu 22.04.1 LTS
Uptime: up 12 minutes

Hardware Information
----------------------
CPU: AMD
Speed:
RAM: 1.9Gi
Disk(s):
NAME   MODEL           SIZE
loop0                 63.3M
loop1                169.2M
loop3                 55.6M
loop4                 49.8M
loop5                  103M
loop6                111.9M
loop7                 49.8M
loop8                168.3M
loop10                55.7M
loop11                63.4M
sda    VBOX HARDDISK    20G
sdb    VBOX HARDDISK    16G
sr0    VBOX CD-ROM    1024M
Video: SVGA

Network Information
---------------------
FQDN: pc200507129
Host Address: 10.0.2.15/24
Gateway IP: 10.0.2.1
DNS Server: 127.0.0.53
Interface Name: enp0s3
IP Address: 10.0.2.15/24

System Status
--------------
Users Logged In: asim
ubuntu
Disk Space:
/dev/mapper/ubuntu--vg-ubuntu--lv 0
/dev/sda2 1.4G
Process Count: 143
Load Averages: 0.26, 1.22, 1.23
Memory Allocation: 785Mi/1.9Gi
Listening Network Ports: 127.0.0.1:19001
127.0.0.1:61209
127.0.0.1:953
127.0.0.1:1338
127.0.0.1:10248
127.0.0.1:10249
127.0.0.1:44265
127.0.0.1:9099
127.0.0.1:10256
10.1.238.64:53
172.16.5.2:53
172.16.3.2:53
172.16.4.2:53
192.168.242.99:53
10.0.2.15:53
127.0.0.1:53
127.0.0.53%lo:53
0.0.0.0:22
[::1]:953
*:16443
*:9090
*:25000
*:10250
*:10257
*:10259
[::1]:53
[fe80::a00:27ff:feaf:2f2b]%enp0s3:53
[fe80::a00:27ff:fecd:902e]%enp0s8:53
[fe80::a00:27ff:fecd:902e]%en-vl20:53
[fe80::a00:27ff:fecd:902e]%en-vl10:53
[fe80::a00:27ff:fecd:902e]%en-vl30:53
[fe80::64be:beff:fe0f:5c5c]%vxlan.calico:53
[::]:22
UFW Rules:
